# 토비 뽀개기 스터디 시즌1 - 2주차

* 스프링의 IOC

<hr>

## 1. 스프링의 IOC

> 스프링은 여러 얼굴을 가졌다
 
* 스프링은 애플리케이션 개발의 다양한 영역과 기술에 관여합니다.
* 스프링의 핵심을 담당하는 것은 빈 팩토리 또는 애플리케이션 컨텍스트

#### 오브젝트 팩토리를 이용한 스프링 IoC

스프링에서는 스프링이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트를<br>
-> <b>빈(Bean)</b>이라고 부릅니다.

자바빈 또는 엔터프라이즈 자바빈(EJB)에서 말하는 빈과 비슷한 <b>오브젝트 단위의 애플리케이션 컴포넌트</b>를 말합니다.

> [엔터프라이즈 자바빈이란?](https://ko.wikipedia.org/wiki/%EC%97%94%ED%84%B0%ED%94%84%EB%9D%BC%EC%9D%B4%EC%A6%88_%EC%9E%90%EB%B0%94%EB%B9%88%EC%A6%88)

스프링 빈은 스프링 컨테이너가 생성과 관계설절, 사용 등을 제어해주는 <b>제어의 역전(IoC)이 적용된 오브젝트</b>를 의미합니다.

스프링 빈 정리
* 스프링이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트
* 제어의 역전이 적용된 오브젝트

스프링에서는 빈의 생성과 관계설정 같은 제어를 담당하는 IoC 오브젝트(이전에 만들었던 BeanFactory 클래스)
-> 빈 팩토리(Bean Factory)라고 부릅니다.

> 보통 빈 팩토리를 보다 확장한 애플리케이션 컨텍스트(Application Context)를 주로 사용합니다.
> 애플리케이션 컨텍스트는 IoC 방식을 따라 만들어진 일종의 빈 팩토리라고 생각하면 됩니다.

* 빈 팩토리 : 빈을 생성하고 관계를 설정하는 IoC의 기본 기능에 초점을 맞춘 것
* 애플리케이션 컨텍스트 : 애플리케이션 전바에 걸쳐 모든 구성요소의 제어 작업을 담당하는 IoC 엔진

@Configuration - 애플리케이션 컨텍스트 또는 빈 팩토리가 사용할 설정정보 라는 표시<br>
@Bean - 오브젝트 생성을 담당하는 IoC용 메서드라는 표시<br>
두 애너테이션은 자바코드의 탈을 쓰고있지만 사실은 XML과 같은 스프링 전용 설정정보 라고 보는것이 좋습니다.

애플리케이션 컨텍스트 -> ApplicationContext 타입의 오브젝트 

ApplicationContext 를 구현한 클래스는 여러 가지가 있습니다.
* AnnotationConfigApplicationContext : @Configuration 이 붙은 코드를 설정정보로 사용할 때 이용하면 됩니다.
* .... 추후 업데이트

빈을 가져올 때는 ApplicationContext 의 getBean() 메서드를 활용
getBean(설정파일 메서드명, 리턴 타임 클래스)
ex) getBean("userDao", UserDao.class)

> getBean 은 기본적으로 Object 타입을 리턴하게 되어있어서 매번 리턴되는 오브젝트에 다시 캐스팅 해줘야하 하는 부담이 있습니다.
> (UserDao) context.getBean("userDao");
> 때문에 두 번째 파라미터에 리턴 타입을 주면, 제네릭 메서드 방식을 사용해서 캐스팅 코드는 사용하지 않아도 됩니다. 


<hr>

### 애플리케이션 컨텍스트의 동작방식

<b>애플리케이션 컨텍스트를 개발자들이 부르는 명칭</b>
* IoC 컨테이너
* 스프링 컨테이너
* 빈 팩토리
* 스프링 (애플리케이션 컨텍스트가 스프링의 가장 대표적인 오브젝트 이므로)

애플리케이션 컨텍스트는 ApplicationContext 인터페이스를 구현하는데, <br>
ApplicationContext는 빈 팩토리가 구현하는 BeanFactory 인터페이스를 상속 했으므로 일종의 빈 팩토리인 셈입니다.

앞에서 만들었던 DaoFactory 와 애플리케이션 컨텍스트를 사용하는것에 어떤 차이가 있는가?<br>
> 애플리케이션 컨텍스트를 사용하는 것은 범용적이고 유연한 방법으로 IoC 기능을 확장하기 위해서입니다.

<hr>

### 애플리케이션 컨텍스트를 사용할 때 얻을 수 있는 장점
* ### 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없습니다.
    - 그 RoomDao 만들어주는 팩토리 클래스 이름이 뭐였지?? -> 팩토리 클래스를 하나씩 열어보며 찾아본다
    - 오브젝트가 필요할때마다 팩토리 오브젝트를 생성해야 하는 번거로움
    - 즉, 애플리케이션 컨텍스트를 이용하면 일관된 방식으로 원하는 오브젝트를 가져올 수 있습니다.
    
* ### 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공해줍니다.
    - 애플리케이션 컨텍스트의 역할은 단지 오브젝트 생성과 다른 오브젝트와의 관계 설정만을 위한것이 아닙니다.
    - 오브젝트가 만들어지는 방식, 시점과 전략을 다르게 설정할 수 있고, 자동생성, 오브젝트의 후처리, 정보의 조합, 설정 방식의 다변화, 인터셉팅 등
    - 오브젝트를 효과적으로 활용할 수 있는 다양한 기능을 제공
    
* ### 애플리케이션 컨텍스트는 빈을 검색하는 다양한 방법을 제공합니다.
    - getBean() 메서드는 빈의 이름을 이용해 빈을 찾아줍니다.
    - 타입만으로 빈을 검색하거나 애너테이션이 설정되어 있는 빈을 찾을 수도 있습니다.

<hr>    

### 스프링 IoC의 용어 정리
* 빈 (Bean)
    - 스프링이 IoC 방식으로 관리하는 오브젝트라는 뜻
    - 관리되는 오브젝트(managed object)라고 부르기도 합니다.
    - 스프링이 직접 그 생성과 제어를 담당하는 오브젝트 만을 의미.
> 주의할 점 - 스프링을 사용하는 애플리케이션에서 만들어지는 모든 오브젝트가 빈은 아닙니다.

* 빈 팩토리 (Bean Factory)
    - 스프링의 IoC를 담당하는 핵심 컨테이너
    - 빈을 등록하고 생성하고 조회하고 돌려주고, 그 외에 부가적인 빈을 관리하는 기능을 담당
> 보통 빈 팩토리를 사용하지 않고 이를 확장한 애플리케이션 컨텍스트를 이용합니다.
  
* 애플리케이션 컨텍스트 (Application Context)
    - 빈 팩토리를 확장한 IoC 컨테이너
    - 빈을 등록하고 관리하는 기본적인 기능은 빈 팩토리와 동일
    - 스프링이 제공하는 각종 부가 서비스를 추가로 제공
    - 애플리케이션 컨텍스트라고 할 때는 스프링이 제공하는 애플리케이션 지원 기능을 모두 포함해서 이야기하는 것
> 빈 팩토리라고 부르는 경우는 주로 빈의 생성과 제어의 관점에서 이야기 하는 것

* 설정정보 / 설정 메타정보 (Configuration Metadata)
    - 애플리케이션 컨텍스트 또는 빈 팩토리가 IoC를 적용하기 위해 사용하는 메타정보를 의미
    - 스프링의 설정정보는 컨테이너에 어떤 정보를 세팅하거나 조정하는 경우에도 사용하지만, 
    - 그보다는 IoC 컨테이너에 의해 관리되는 애플리케이션 오브젝트를 생성하고 구성할 때 사용.
> 애플리케이션의 형상정보 라고도 합니다.

* 컨테이너 (Container) 또는 IoC 컨테이너
    - IoC 방식으로 빈을 관리한다는 의미에서 애플리케이션 컨텍스트나 빈 팩토리를 의미
    - 컨테이너(스프링 컨테이너) == 애플리케이션 컨테이너
    - IoC 컨테이너 == 빈 팩토리 관점에서 이야기 하는 것
    
* 스프링 프레임워크
    - IoC 컨테이너, 애플리케이션 컨텍스트를 포함해서 스프링이 제공하는 모든 기능을 통틀어 말함
  
<hr>

## 2. 싱글톤 레지스트리와 오브젝트 스코프

* DaoFactory 를 직접 사용하는것 (new DaoFactory().userDao()처럼 사용하는 것)
* @Configuration 애너테이션을 추가해서 스프링의 애플리케이션 컨텍스트를 통해 사용하는 것
위의 두가지는 어떤 차이가 있을까요?

만약 DaoFactory(@Configuration을 붙이지 않은)을 사용해서 userDao() 메서드를 두번 호출해서 만든 UserDao 오브젝트는 동일한(identical) 오브젝트 일까?

> ### 오브젝트의 동일성과 동등성<br>
> 자바에서 두 개의 오브젝트가 <br>
> 완전히 같은 동일한(identical) 오브젝트 라고 하는것과 -> 동일성 비교, == 연산자 사용<br>
> 동일한 정보를 담고 있는(equivalent) 오브젝트라고 말하는 것 -> 동등성 비교, equals() 메서드 사용<br>
> equals() 메서드를 따로 오버라이딩해서 구현하지 않으면 Object 의 equals() 메서드를 그대로 사용하는데 이는 두 오브젝트의 동일성을 비교해서 결과를 반환합니다.

결론적으로 위의 DaoFactory 의 userDao() 메서드는 매번 다른 오브젝트를 생성해줍니다.<br>
하지만 스프링 애플리케이션 컨텍스를 사용해서 생성하는 UserDao 오브젝트는 매번 같은 오브젝트를 반환해줍니다.

<hr>

### 싱글톤 레지스트리로서의 애플리케이션 컨텍스트
애플리케이션 컨텍스트는 <b>싱글톤</b>을 저장하고 관리하는 <b>싱글톤 레스트트리</b> 이기도 합니다.

스프링은 기본적으로 별다른 설정을 하지 않으면 내부에서 생성하는 <b>빈 오브젝트는 모두 싱글톤으로 만듭니다.</b>

태생적으로 스프링은 엔터프라이즈 시스템을 위해 고안된 기술이기 때문에 서버환경에서 사용될 때 그 가치가 있습니다.
> 실제로 스프링은 대부분 서버환경에서 사용됩니다.

만약 초당 수십, 수백번의 요청이 오는데 그 때마다 각 로직을 담당하는 오브젝트가 새로 만들어지고 사용된다면 서버에 부하가 발생합니다.<br>
이런 부하를 줄이기 위해 엔터프라이즈 분야에서는 서비스 오브젝트라는 개념을 일찍부터 사용해왔습니다.<br>
서블릿은 대부분 멀티스레드 환경에서 싱글톤으로 동작합니다.<br>
* 서블릿 클래스당 하나의 오브젝트만 만들어두고, 
* 사용자의 요청을 담당하는 여러 스레드에서 하나의 오브젝트를 공유해 동시에 사용합니다.

> ### [싱글턴 패턴이란?](https://julog.netlify.app/JavaScript/Singleton_Pattern/) 
> 애플리케이션 안에 제한된 수, 대개 한 개의 오브젝트만 만들어서 사용하는 것이 싱글톤 패턴의 원리

<hr>

### 싱글톤 패턴의 한계

* 







